<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Talent Storage</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
      }
      .section {
        background: #f5f5f5;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
      }
      button {
        background: #22c55e;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #16a34a;
      }
      .btn-danger {
        background: #ef4444;
      }
      .btn-danger:hover {
        background: #dc2626;
      }
      pre {
        background: white;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
      }
      input,
      textarea {
        width: 100%;
        padding: 8px;
        margin: 5px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Test Talent Storage System</h1>

    <div class="section">
      <h2>üìù Add Test Talent</h2>
      <input
        type="text"
        id="testName"
        placeholder="Nama Talent (e.g., React Developer)"
      />
      <textarea
        id="testDesc"
        rows="3"
        placeholder="Deskripsi (e.g., Spesialis React.js dengan 3 tahun pengalaman)"
      ></textarea>
      <button onclick="addTestTalent()">Add Talent</button>
    </div>

    <div class="section">
      <h2>üìä Current Storage Status</h2>
      <button onclick="checkStorage()">Check Storage</button>
      <button onclick="viewTalents()">View All Talents</button>
      <button class="btn-danger" onclick="clearTalents()">
        Clear All Talents
      </button>
      <pre id="storageInfo">Click "Check Storage" to see current data...</pre>
    </div>

    <div class="section">
      <h2>üîç Session Info</h2>
      <button onclick="checkSession()">Check Session</button>
      <pre id="sessionInfo">
Click "Check Session" to see current user session...</pre
      >
    </div>

    <script>
      function addTestTalent() {
        const name = document.getElementById("testName").value.trim();
        const desc = document.getElementById("testDesc").value.trim();

        if (!name || !desc) {
          alert("Nama dan deskripsi harus diisi!");
          return;
        }

        try {
          // Get current session
          const session = JSON.parse(
            localStorage.getItem("bantuin_session") || "null"
          );
          const profile = JSON.parse(
            localStorage.getItem("rpl_profile") || "null"
          );

          const userName =
            (session && session.user) ||
            (profile && profile.name) ||
            "Test User";
          const userEmail =
            (session && session.email) ||
            (profile && profile.email) ||
            "test@example.com";

          // Create talent object
          const talent = {
            id: Date.now(),
            name: name,
            desc: desc,
            role: name,
            owner: userName,
            email: userEmail,
            category: "it",
            level: "intermediate",
            availability: "available",
            createdAt: new Date().toISOString(),
          };

          // Get current talents
          let talents = JSON.parse(
            localStorage.getItem("bantuin_talents") || "[]"
          );

          // Add new talent
          talents.unshift(talent);

          // Save back
          localStorage.setItem("bantuin_talents", JSON.stringify(talents));

          console.log("Talent added:", talent);
          alert(
            "‚úÖ Talent berhasil ditambahkan!\n\nTotal talents: " +
              talents.length
          );

          // Clear form
          document.getElementById("testName").value = "";
          document.getElementById("testDesc").value = "";

          // Auto refresh display
          viewTalents();
        } catch (error) {
          console.error("Error adding talent:", error);
          alert("‚ùå Error: " + error.message);
        }
      }

      function checkStorage() {
        try {
          const talents = JSON.parse(
            localStorage.getItem("bantuin_talents") || "[]"
          );
          const info = {
            totalTalents: talents.length,
            storageKey: "bantuin_talents",
            sampleData: talents.length > 0 ? talents[0] : "No talents found",
            allKeys: Object.keys(localStorage).filter((k) =>
              k.includes("talent")
            ),
          };

          document.getElementById("storageInfo").textContent = JSON.stringify(
            info,
            null,
            2
          );
          console.log("Storage check:", info);
        } catch (error) {
          document.getElementById("storageInfo").textContent =
            "Error: " + error.message;
        }
      }

      function viewTalents() {
        try {
          const talents = JSON.parse(
            localStorage.getItem("bantuin_talents") || "[]"
          );

          if (talents.length === 0) {
            document.getElementById("storageInfo").textContent =
              "No talents found in storage.";
            return;
          }

          document.getElementById("storageInfo").textContent = JSON.stringify(
            talents,
            null,
            2
          );
          console.log("All talents:", talents);
        } catch (error) {
          document.getElementById("storageInfo").textContent =
            "Error: " + error.message;
        }
      }

      function clearTalents() {
        if (
          confirm(
            "‚ö†Ô∏è Hapus semua talent data?\n\nTindakan ini tidak dapat dibatalkan!"
          )
        ) {
          localStorage.removeItem("bantuin_talents");
          alert("‚úÖ All talents cleared!");
          viewTalents();
        }
      }

      function checkSession() {
        try {
          const session = localStorage.getItem("bantuin_session");
          const profile = localStorage.getItem("rpl_profile");
          const currentRole = localStorage.getItem("rpl_currentRole");

          const info = {
            hasSession: !!session,
            session: session ? JSON.parse(session) : null,
            hasProfile: !!profile,
            profile: profile ? JSON.parse(profile) : null,
            currentRole: currentRole,
          };

          document.getElementById("sessionInfo").textContent = JSON.stringify(
            info,
            null,
            2
          );
          console.log("Session info:", info);
        } catch (error) {
          document.getElementById("sessionInfo").textContent =
            "Error: " + error.message;
        }
      }

      // Auto-check on load
      window.addEventListener("DOMContentLoaded", function () {
        console.log("Test page loaded");
        checkStorage();
      });
    </script>
  </body>
</html>
